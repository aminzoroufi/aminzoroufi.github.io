<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=generator content="Wowchemy 4.8.0 for Hugo"><meta name=author content="Dezhi Yu"><meta name=description content="The handshake protocol is used to negotiate the security parameters of the connection. The handshake messages are provided to the TLS recording layer, where they are encapsulated into one or more TLSPlaintext or TLSCiphertext, and they are processed and transmitted according to the current active connection state. Protocol messages must be sent in a certain order (see below for the order). If the peer finds that the received handshake messages are not in the right order, they must use the &#34;unexpected_message&#34; alert message to abort the handshake."><link rel=alternate hreflang=en-us href="index.html"><link rel=preconnect href=https://fonts.gstatic.com crossorigin><meta name=theme-color content="#2962ff"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/academicons/1.9.0/css/academicons.min.css integrity="sha512-W4yqoT1+8NLkinBLBZko+dFB2ZbHsYLDdr50VElllRcNt2Q4/GSs6u71UHKxB7S6JEMCp5Ve4xjh3eGQl/HRvg==" crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css integrity="sha256-FMvZuGapsJLjouA6k7Eo2lusoAX9i0ShlWFG6qt7SLc=" crossorigin=anonymous><script src=https://cdnjs.cloudflare.com/ajax/libs/lazysizes/5.2.2/lazysizes.min.js integrity="sha512-TmDwFLhg3UA4ZG0Eb4MIyT1O1Mb+Oww5kFG0uHqXsdbyZz9DcvYQhKpGgNkamAI6h2lGGZq2X8ftOJvF/XjTUg==" crossorigin=anonymous async></script><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Montserrat:400,700%7CRoboto:400,400italic,700%7CRoboto+Mono&display=swap"><link rel=stylesheet href="../../css/wowchemy.min.6bebb0d456d483a90e700424b8bbfea8.css"><link rel=manifest href="../../index.webmanifest"><link rel=icon type=image/png href="../../images/icon_hu545dc38133db00f2a0f3ba46257a5641_68992_32x32_fill_lanczos_center_2.png"><link rel=apple-touch-icon type=image/png href="../../images/icon_hu545dc38133db00f2a0f3ba46257a5641_68992_192x192_fill_lanczos_center_2.png"><link rel=canonical href="index.html"><meta property="twitter:card" content="summary_large_image"><meta property="twitter:site" content="@halffrost"><meta property="twitter:creator" content="@halffrost"><meta property="og:site_name" content="Dezhi Yu"><meta property="og:url" content="https://halfrost.me/post/tls-1.3-handshake-protocol/"><meta property="og:title" content="TLS 1.3 Handshake Protocol | Dezhi Yu"><meta property="og:description" content="The handshake protocol is used to negotiate the security parameters of the connection. The handshake messages are provided to the TLS recording layer, where they are encapsulated into one or more TLSPlaintext or TLSCiphertext, and they are processed and transmitted according to the current active connection state. Protocol messages must be sent in a certain order (see below for the order). If the peer finds that the received handshake messages are not in the right order, they must use the &#34;unexpected_message&#34; alert message to abort the handshake."><meta property="og:image" content="https://halfrost.me/post/tls-1.3-handshake-protocol/featured.png"><meta property="twitter:image" content="https://halfrost.me/post/tls-1.3-handshake-protocol/featured.png"><meta property="og:locale" content="en-us"><meta property="article:published_time" content="2018-10-21T10:05:36+00:00"><meta property="article:modified_time" content="2020-10-12T10:17:51+00:00"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://halfrost.me/post/tls-1.3-handshake-protocol/"},"headline":"TLS 1.3 Handshake Protocol","image":["https://halfrost.me/post/tls-1.3-handshake-protocol/featured.png"],"datePublished":"2018-10-21T10:05:36Z","dateModified":"2020-10-12T10:17:51Z","author":{"@type":"Person","name":"halfrost"},"publisher":{"@type":"Organization","name":"Dezhi Yu","logo":{"@type":"ImageObject","url":"https://halfrost.me/images/icon_hu545dc38133db00f2a0f3ba46257a5641_68992_192x192_fill_lanczos_center_2.png"}},"description":"The handshake protocol is used to negotiate the security parameters of the connection. The handshake messages are provided to the TLS recording layer, where they are encapsulated into one or more TLSPlaintext or TLSCiphertext, and they are processed and transmitted according to the current active connection state. Protocol messages must be sent in a certain order (see below for the order). If the peer finds that the received handshake messages are not in the right order, they must use the \"unexpected_message\" alert message to abort the handshake."}</script><script async src="https://www.googletagmanager.com/gtag/js?id=UA-82753806-6"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-82753806-6');</script><title>TLS 1.3 Handshake Protocol | Dezhi Yu</title></head><body id=top data-spy=scroll data-offset=70 data-target=#TableOfContents><script>window.wcDarkLightEnabled=true;</script><script>const isSiteThemeDark=false;</script><script src="../../js/load-theme.js"></script><aside class=search-results id=search><div class=container><section class=search-header><div class="row no-gutters justify-content-between mb-3"><div class=col-6><h1>Search</h1></div><div class="col-6 col-search-close"><a class=js-search href="index.html#"><i class="fas fa-times-circle text-muted" aria-hidden=true></i></a></div></div><div id=search-box></div></section><section class=section-search-results><div id=search-hits></div></section></div></aside><nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id=navbar-main style=font-size:1rem><div class=container><div class="d-none d-lg-inline-flex"><a class=navbar-brand href="../../index.html">Dezhi Yu</a></div><button type=button class=navbar-toggler data-toggle=collapse data-target=#navbar-content aria-controls=navbar aria-expanded=false aria-label="Toggle navigation">
<span><i class="fas fa-bars"></i></span></button><div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none"><a class=navbar-brand href="../../index.html">Dezhi Yu</a></div><div class="navbar-collapse main-menu-item collapse justify-content-start" id=navbar-content><ul class="navbar-nav d-md-inline-flex"><li class=nav-item><a class=nav-link href="../../index.html#about"><span>Home</span></a></li><li class=nav-item><a class=nav-link href="../../index.html#experience"><span>Experience</span></a></li><li class=nav-item><a class=nav-link href="../../index.html#accomplishments"><span>Accomplishments</span></a></li><li class=nav-item><a class=nav-link href="../../index.html#posts"><span>Posts</span></a></li><li class=nav-item><a class=nav-link href="../../index.html#projects"><span>Projects</span></a></li><li class=nav-item><a class=nav-link href="../../index.html#publications"><span>Publications</span></a></li><li class=nav-item><a class=nav-link href="../../index.html#talks"><span>Talks</span></a></li><li class=nav-item><a class=nav-link href="../../index.html#skills"><span>Skills</span></a></li><li class=nav-item><a class=nav-link href="../../index.html#contact"><span>Contact</span></a></li></ul><ul class="navbar-nav ml-md-auto"><li class=nav-item><a class=nav-link href=https://www.coursera.org/user/94d1260a778d0a3918ef95b4c1063486 target=_blank rel=noopener><span><i class="ai ai-coursera" style=font-size:1.5rem;line-height:1.25></i></span></a></li><li class=nav-item><a class=nav-link href="../../cv.pdf"><span><i class="ai ai-cv" style=font-size:1.5rem;line-height:1.25></i></span></a></li></ul></div><ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2"><li class="nav-item dropdown theme-dropdown"><a href="index.html#" class=nav-link data-toggle=dropdown aria-haspopup=true><i class="fas fa-moon"></i></a><div class=dropdown-menu><a href="index.html#" class="dropdown-item js-set-theme-light"><span>Light</span></a>
<a href="index.html#" class="dropdown-item js-set-theme-dark"><span>Dark</span></a>
<a href="index.html#" class="dropdown-item js-set-theme-auto"><span>Automatic</span></a></div></li></ul></div></nav><article class=article><div class="article-container pt-3"><h1>TLS 1.3 Handshake Protocol</h1><div class=article-metadata><div><span><a href="../../author/halfrost/index.html">halfrost</a></span></div><span class=article-date>Last updated on
Oct 12, 2020</span>
<span class=middot-divider></span><span class=article-reading-time>1 min read</span>
<span class=middot-divider></span><span class=article-categories><i class="fas fa-folder mr-1"></i><a href="../../category/protocol/index.html">PROTOCOL</a></span></div><div class="btn-links mb-3"><a class="btn btn-outline-primary my-1 mr-1" href=https://halfrost.com/tls_1-3_handshake_protocol/ target=_blank rel=noopener>Read More</a></div></div><div class="article-header article-container featured-image-wrapper mt-4 mb-4" style=max-width:720px;max-height:405px><div style=position:relative><img src="featured_hu7108cd14c45a79885115483a3070e3ec_166939_720x0_resize_lanczos_2.png" alt class=featured-image></div></div><div class=article-container><div class=article-style><p>握手协议用于协商连接的安全参数。握手消息被提供给 TLS 记录层，在记录层它们被封装到一个或多个 TLSPlaintext 或 TLSCiphertext 中，它们按照当前活动连接状态进行处理和传输。</p><pre><code class=language-c>      enum {
          client_hello(1),
          server_hello(2),
          new_session_ticket(4),
          end_of_early_data(5),
          encrypted_extensions(8),
          certificate(11),
          certificate_request(13),
          certificate_verify(15),
          finished(20),
          key_update(24),
          message_hash(254),
          (255)
      } HandshakeType;

      struct {
          HandshakeType msg_type;    /* handshake type */
          uint24 length;             /* remaining bytes in message */
          select (Handshake.msg_type) {
              case client_hello:          ClientHello;
              case server_hello:          ServerHello;
              case end_of_early_data:     EndOfEarlyData;
              case encrypted_extensions:  EncryptedExtensions;
              case certificate_request:   CertificateRequest;
              case certificate:           Certificate;
              case certificate_verify:    CertificateVerify;
              case finished:              Finished;
              case new_session_ticket:    NewSessionTicket;
              case key_update:            KeyUpdate;
          };
      } Handshake;
</code></pre><p>协议消息必须按照一定顺序发送(顺序见下文)。如果对端发现收到的握手消息顺序不对，必须使用 “unexpected_message” alert 消息来中止握手。</p><p>点击<a href=https://halfrost.com/tls_1-3_handshake_protocol/ target=_blank rel=noopener>阅读更多</a>看全文。</p></div><div class=article-tags><a class="badge badge-light" href="../../tag/https/index.html">HTTPS</a>
<a class="badge badge-light" href="../../tag/protocol/index.html">PROTOCOL</a></div><div class=share-box aria-hidden=true><ul class=share><li><a href="https://twitter.com/intent/tweet?url=https://halfrost.me/post/tls-1.3-handshake-protocol/&text=TLS%201.3%20Handshake%20Protocol" target=_blank rel=noopener class=share-btn-twitter><i class="fab fa-twitter"></i></a></li><li><a href="https://www.facebook.com/sharer.php?u=https://halfrost.me/post/tls-1.3-handshake-protocol/&t=TLS%201.3%20Handshake%20Protocol" target=_blank rel=noopener class=share-btn-facebook><i class="fab fa-facebook"></i></a></li><li><a href="mailto:?subject=TLS%201.3%20Handshake%20Protocol&body=https://halfrost.me/post/tls-1.3-handshake-protocol/" target=_blank rel=noopener class=share-btn-email><i class="fas fa-envelope"></i></a></li><li><a href="https://www.linkedin.com/shareArticle?url=https://halfrost.me/post/tls-1.3-handshake-protocol/&title=TLS%201.3%20Handshake%20Protocol" target=_blank rel=noopener class=share-btn-linkedin><i class="fab fa-linkedin-in"></i></a></li><li><a href="whatsapp://send?text=TLS%201.3%20Handshake%20Protocol%20https://halfrost.me/post/tls-1.3-handshake-protocol/" target=_blank rel=noopener class=share-btn-whatsapp><i class="fab fa-whatsapp"></i></a></li><li><a href="https://service.weibo.com/share/share.php?url=https://halfrost.me/post/tls-1.3-handshake-protocol/&title=TLS%201.3%20Handshake%20Protocol" target=_blank rel=noopener class=share-btn-weibo><i class="fab fa-weibo"></i></a></li></ul></div><div class="article-widget content-widget-hr"><h3>Related</h3><ul><li><a href="../detailed-http-2-header-compression-algorithm-hpack/index.html">Detailed HTTP/2 header compression algorithm-HPACK</a></li></ul></div></div></article><script src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin=anonymous></script><script async src=https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin=anonymous></script><script async src=https://cdnjs.cloudflare.com/ajax/libs/instant.page/5.1.0/instantpage.min.js integrity="sha512-1+qUtKoh9XZW7j+6LhRMAyOrgSQKenQ4mluTR+cvxXjP1Z54RxZuzstR/H9kgPXQsVB8IW7DMDFUJpzLjvhGSQ==" crossorigin=anonymous></script><script>const code_highlighting=false;</script><script src="../../js/wowchemy.min.81c0016b87774b0bb25faf17d087c994.js"></script><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class=container><footer class=site-footer><p class=powered-by style=font-size:1rem>© 2024 · Dezhi Yu
<span class=float-right><a href="index.html#" class=back-to-top><span class=button_icon><i class="fas fa-chevron-up fa-2x" style=font-size:1.8rem></i></span></a></span></p><p class="copyright statistics" style=font-size:.9rem><span id=busuanzi_container_site_pv>Cumulative Page Views <span id=busuanzi_value_site_pv></span>&nbsp; | Unique Visitors <span id=busuanzi_value_site_uv></span></span></p></footer></div><div id=modal class="modal fade" role=dialog><div class=modal-dialog><div class=modal-content><div class=modal-header><h5 class=modal-title>Cite</h5><button type=button class=close data-dismiss=modal aria-label=Close>
<span aria-hidden=true>&#215;</span></button></div><div class=modal-body><pre><code class="tex hljs"></code></pre></div><div class=modal-footer><a class="btn btn-outline-primary my-1 js-copy-cite" href="index.html#" target=_blank><i class="fas fa-copy"></i>Copy</a>
<a class="btn btn-outline-primary my-1 js-download-cite" href="index.html#" target=_blank><i class="fas fa-download"></i>Download</a><div id=modal-error></div></div></div></div></div></body></html>